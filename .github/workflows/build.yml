name: AmurCore Build

on:
  push:
    branches: [ develop ]
#     tags:
#       - '*'

env:
  BUILD_TYPE: Release

jobs:
  build:
    runs-on: windows-latest
#     defaults:
#         run:
#             shell: msys2 {0}

    steps:
      - name: 'ðŸ§° Checkout'
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
        
      - name: 'Setup MSYS2'
        uses: msys2/setup-msys2@v2
        with:
          location: D:\
          msystem: mingw64
          update: true
          install: >-
            git
            make
          pacboy: >-
            toolchain:p
            cmake:p
            libconfig:p
            grpc:p
            protobuf:p
            opencv:p
            ninja:p
            SDL2:p
            qwt-qt5:p
            qt5-base:p
            qt5-tools:p
            qt5-static:p
            qt5-speech:p
            qt5-multimedia:p
            qt5-translations:p
          
#       - name: 'ðŸš§ Build TOOL'
#         run: |
#           cmake -G Ninja -B build -DCMAKE_BUILD_TYPE=Release
#           cmake --build build
                                        
#       - name: Install Qt
#         uses: jurplel/install-qt-action@v3
#         with:
#           version: '5.15.2'
#           host: 'windows'
#           target: 'desktop'
#           arch: 'win64_msvc2019_64'
#           dir: '${{ github.workspace }}/example/'
#           install-deps: 'true'
#           modules: 'qtcharts qtwebengine'
#           archives: 'qtbase qtsvg'
#           cache: 'false'
#           cache-key-prefix: 'install-qt-action'
#           setup-python: 'true'
#           tools: 'tools_ifw tools_qtcreator,qt.tools.qtcreator'
#           set-env: 'true'
#           tools-only: 'false'
#           aqtversion: '==2.1.*'
#           py7zrversion: '==0.19.*'
#           extra: '--external 7z'

#       - name: Setup cmake
#         uses: jwlawson/actions-setup-cmake@v1.13
#         with:
#           cmake-version: '3.16.x'
        
      - name: dir q
        run: dir D:\msys64\mingw64\lib\cmake
        
      - name: Configure CMake
        env:
          CMAKE_PREFIX_PATH: D:\msys64\mingw64\lib\cmake 
        run: cmake -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} -B '${{github.workspace}}'/build

      - name: Build
        run: cmake --build '${{github.workspace}}'/build

      - name: dir p
        run: dir '${{github.workspace}}'/build
        
      - uses: montudor/action-zip@v1
        with:
          args: zip -qq -r AmurCore-${{ github.ref_name }}-windows.zip '${{github.workspace}}'/build

      - name: Release
        if: ${{ github.event.action == 'released' || github.event.action == 'prereleased' }}
        uses: softprops/action-gh-release@17cd0d34deddf848fc0e7d9be5202c148c270a0a
        with:
          files: AmurCore-${{ github.ref_name }}-windows.zip


